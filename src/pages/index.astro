---
import MainContent from "../components/MainContent.astro";
import Profile from "../components/Profile.astro";
import Statistics from "../components/Statistics.astro";
import Tags from "../components/Tags.astro";
import PostCard from "../components/PostCard.astro";
import Spotify from "../components/Spotify.astro";

const posts = await Astro.glob("./posts/*.md");

const latestPosts = posts
	.map((post) => ({
		title: post.frontmatter?.title ?? "未命名文章",
		description: post.frontmatter?.description ?? "",
		// 使用 lastUpdated 作为展示时间，如果没有则回退到 pubDate（兼容旧文章）
		date: post.frontmatter?.lastUpdated
			? new Date(post.frontmatter.lastUpdated)
			: post.frontmatter?.pubDate
				? new Date(post.frontmatter.pubDate)
				: null,
		url: post.url || "#",
		tags: (post.frontmatter?.tags as string[]) || [],
	}))
	.filter((post) => post.url !== "#")
	.sort((a, b) => (b.date?.getTime() ?? 0) - (a.date?.getTime() ?? 0));
---
<html lang="zh-cn">
	<head>
		<meta charset="utf-8" />
		<link rel="icon" type="image/svg+xml" href="/favicon.svg" />
		<meta name="viewport" content="width=device-width" />
		<meta name="generator" content={Astro.generator} />
		<title>Lustre · 主页</title>
		<link rel="stylesheet" href="/src/styles/global.css" />
	</head>
	<body>
		<!-- Hero 背景图区域（全屏，带标题） -->
		<div class="hero-bg">
			<div class="hero-title">
				<h1 class="hero-title-main">Lustre's Blog</h1>
				<p class="hero-title-sub">Welcome to my digital space</p>
			</div>
			<div class="scroll-indicator">
				<span class="scroll-text">Scroll Down</span>
				<svg class="scroll-arrow" width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
					<path d="M7 10L12 15L17 10" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
				</svg>
			</div>
		</div>
		
		<!-- 内容区域（滚动后可见，渐变背景） -->
		<div class="content-section">
			<MainContent title="Lustre · 主页">
				<Fragment slot="sidebar">
					<Profile />
					<Spotify />
					<Statistics />
					<Tags />
				</Fragment>

				<div>
					<h1 style="font-size: 2rem; margin: 0 0 2rem 0;">最新文章</h1>
					{latestPosts.length > 0 ? (
						<div>
							{latestPosts.map((post) => (
								<PostCard
									title={post.title}
									{...(post.description ? { description: post.description } : {})}
									{...(post.date ? { date: post.date } : {})}
									url={post.url}
									{...(post.tags.length > 0 ? { tags: post.tags } : {})}
								/>
							))}
						</div>
					) : (
						<p style="text-align: center; color: rgba(249, 250, 251, 0.6); padding: 3rem;">
							暂无文章，敬请期待。
						</p>
					)}
				</div>
			</MainContent>
		</div>
	</body>
</html>
