---
// Giscus è¯„è®ºç³»ç»Ÿé…ç½®
// éœ€è¦å…ˆåœ¨ GitHub ä»“åº“ä¸­å¯ç”¨ Discussions åŠŸèƒ½
// ç„¶åè®¿é—® https://giscus.app è·å–é…ç½®ä¿¡æ¯
interface Props {
	repo?: string; // æ ¼å¼: "username/repo"
	repoId?: string; // ä» giscus.app è·å–
	category?: string; // ä» giscus.app è·å–
	categoryId?: string; // ä» giscus.app è·å–
}

const {
	repo = "theLustre/theLustre.github.io",
	repoId = "R_kgDOQeHXwg",
	category = "General",
	categoryId = "DIC_kwDOQeHXws4CzNNt",
} = Astro.props;

// è·å–å½“å‰é¡µé¢ URL
const pageUrl = Astro.url.href;
const pagePath = Astro.url.pathname;
---

<div class="comments-section">
	<h2 class="comments-title">ğŸ’¬ è¯„è®º</h2>
	<p class="comments-note">
		è¯„è®ºéœ€è¦ GitHub è´¦å·ç™»å½•ï¼Œæ‚¨çš„ç”¨æˆ·åå’Œé‚®ç®±å°†ç”¨äºæ˜¾ç¤ºè¯„è®ºã€‚
	</p>
	
	{!repoId || !categoryId ? (
		<div class="comments-config-notice">
			<p><strong>âš ï¸ è¯„è®ºç³»ç»Ÿæœªé…ç½®</strong></p>
			<p>è¯·æŒ‰ç…§ä»¥ä¸‹æ­¥éª¤é…ç½®ï¼š</p>
			<ol>
				<li>åœ¨ GitHub ä»“åº“ä¸­å¯ç”¨ Discussions</li>
				<li>å®‰è£… Giscus åº”ç”¨åˆ° <strong>ç‰¹å®šä»“åº“</strong>ï¼ˆä¸æ˜¯"æ‰€æœ‰ä»“åº“"ï¼‰ï¼š<a href="https://github.com/apps/giscus" target="_blank">https://github.com/apps/giscus</a></li>
				<li>è®¿é—® <a href="https://giscus.app" target="_blank">giscus.app</a>ï¼Œ<strong>é‡è¦</strong>ï¼šåœ¨ Repository ä¸‹æ‹‰èœå•ä¸­å¿…é¡»é€‰æ‹© <code>theLustre/theLustre.github.io</code>ï¼ˆä¸è¦é€‰æ‹©"All repositories"ï¼‰</li>
				<li>ä»ç”Ÿæˆçš„ä»£ç ä¸­å¤åˆ¶ <code>data-repo-id</code> å’Œ <code>data-category-id</code> çš„å€¼</li>
				<li>æ›´æ–° <code>src/components/Comments.astro</code> ä¸­çš„ <code>repoId</code> å’Œ <code>categoryId</code></li>
			</ol>
			<p><strong>å¦‚æœ giscus.app æ²¡æœ‰æ˜¾ç¤º IDï¼š</strong></p>
			<ul>
				<li>ç¡®ä¿é€‰æ‹©äº†<strong>ç‰¹å®šä»“åº“</strong>ï¼Œä¸æ˜¯"æ‰€æœ‰ä»“åº“"</li>
				<li>ç¡®ä¿ä»“åº“å·²å¯ç”¨ Discussions å¹¶åˆ›å»ºäº†è‡³å°‘ä¸€ä¸ª category</li>
				<li>æŸ¥çœ‹è¯¦ç»†è¯´æ˜ï¼š<code>docs/get-giscus-ids.md</code></li>
			</ul>
		</div>
	) : null}
	
	{repoId && categoryId && (
		<!-- Giscus è¯„è®ºç³»ç»Ÿ -->
		<div class="giscus-container">
			<script
				src="https://giscus.app/client.js"
				data-repo={repo}
				data-repo-id={repoId}
				data-category={category}
				data-category-id={categoryId}
				data-mapping="pathname"
				data-strict="0"
				data-reactions-enabled="1"
				data-emit-metadata="0"
				data-input-position="bottom"
				data-theme="dark"
				data-lang="zh-CN"
				crossorigin="anonymous"
				async
			></script>
		</div>
	)}
</div>

<style>
	.comments-section {
		margin-top: 3rem;
		padding-top: 2rem;
		border-top: 1px solid rgba(255, 255, 255, 0.1);
	}

	.comments-title {
		font-size: 1.5rem;
		font-weight: 600;
		margin: 0 0 0.5rem 0;
		color: #f9fafb;
	}

	.comments-note {
		font-size: 0.875rem;
		color: rgba(249, 250, 251, 0.6);
		margin: 0 0 1.5rem 0;
		line-height: 1.6;
	}

	.giscus-container {
		margin-top: 1.5rem;
	}

	.comments-config-notice {
		padding: 1.5rem;
		background: rgba(255, 193, 7, 0.1);
		border: 1px solid rgba(255, 193, 7, 0.3);
		border-radius: 12px;
		color: rgba(249, 250, 251, 0.9);
	}

	.comments-config-notice p {
		margin: 0.5rem 0;
		line-height: 1.6;
	}

	.comments-config-notice ol {
		margin: 0.5rem 0;
		padding-left: 1.5rem;
	}

	.comments-config-notice li {
		margin: 0.5rem 0;
	}

	.comments-config-notice a {
		color: #8dd0ff;
		text-decoration: none;
	}

	.comments-config-notice a:hover {
		color: #5b9aff;
		text-decoration: underline;
	}

	.comments-config-notice code {
		background: rgba(255, 255, 255, 0.1);
		padding: 0.2rem 0.4rem;
		border-radius: 4px;
		font-size: 0.9em;
	}

	/* Giscus ä¸»é¢˜é€‚é… */
	:global(.giscus) {
		margin-top: 1rem;
	}

	/* ç¡®ä¿ Giscus åœ¨æš—è‰²ä¸»é¢˜ä¸‹æ­£å¸¸æ˜¾ç¤º */
	:global(.giscus-frame) {
		color-scheme: dark;
	}
</style>

